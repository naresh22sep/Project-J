{% extends "layouts/frontend_layout.html" %}

{% block title %}Find Jobs - JobHunter{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section py-5" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="display-4 fw-bold mb-3">Find Your Dream Job</h1>
                <p class="lead mb-4">Discover thousands of opportunities from top companies around the world</p>
                
                <!-- Job Search Form -->
                <form method="GET" action="{{ url_for('jobseeker.jobs') }}" class="job-search-form">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <div class="input-group">
                                <span class="input-group-text bg-white">
                                    <i class="fas fa-search text-primary"></i>
                                </span>
                                <input type="text" name="search" class="form-control" 
                                       placeholder="Job title or keywords" 
                                       value="{{ request.args.get('search', '') }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="input-group">
                                <span class="input-group-text bg-white">
                                    <i class="fas fa-map-marker-alt text-primary"></i>
                                </span>
                                <input type="text" name="location" class="form-control" 
                                       placeholder="Location" 
                                       value="{{ request.args.get('location', '') }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <select name="category" class="form-select">
                                <option value="">All Categories</option>
                                <option value="technology" {% if request.args.get('category') == 'technology' %}selected{% endif %}>Technology</option>
                                <option value="finance" {% if request.args.get('category') == 'finance' %}selected{% endif %}>Finance</option>
                                <option value="healthcare" {% if request.args.get('category') == 'healthcare' %}selected{% endif %}>Healthcare</option>
                                <option value="education" {% if request.args.get('category') == 'education' %}selected{% endif %}>Education</option>
                                <option value="marketing" {% if request.args.get('category') == 'marketing' %}selected{% endif %}>Marketing</option>
                                <option value="sales" {% if request.args.get('category') == 'sales' %}selected{% endif %}>Sales</option>
                                <option value="other" {% if request.args.get('category') == 'other' %}selected{% endif %}>Other</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button type="submit" class="btn btn-light btn-lg w-100">
                                <i class="fas fa-search"></i> Search
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="col-lg-4 text-center">
                <div class="search-stats bg-white text-dark p-4 rounded shadow">
                    <h3 class="text-primary mb-2">{{ total_jobs }}</h3>
                    <p class="mb-1">Active Jobs Available</p>
                    <small class="text-muted">Updated daily</small>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Filters Section -->
<section class="py-4 bg-light">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8">
                <div class="d-flex flex-wrap align-items-center">
                    <span class="me-3 fw-bold">Filter by:</span>
                    
                    <!-- Job Type Filter -->
                    <div class="btn-group me-3 mb-2" role="group">
                        <input type="radio" class="btn-check" name="job_type" id="job_type_all" value="" 
                               {% if not request.args.get('job_type') %}checked{% endif %}>
                        <label class="btn btn-outline-primary btn-sm" for="job_type_all">All Types</label>
                        
                        <input type="radio" class="btn-check" name="job_type" id="job_type_full_time" value="full_time" 
                               {% if request.args.get('job_type') == 'full_time' %}checked{% endif %}>
                        <label class="btn btn-outline-primary btn-sm" for="job_type_full_time">Full Time</label>
                        
                        <input type="radio" class="btn-check" name="job_type" id="job_type_part_time" value="part_time" 
                               {% if request.args.get('job_type') == 'part_time' %}checked{% endif %}>
                        <label class="btn btn-outline-primary btn-sm" for="job_type_part_time">Part Time</label>
                        
                        <input type="radio" class="btn-check" name="job_type" id="job_type_contract" value="contract" 
                               {% if request.args.get('job_type') == 'contract' %}checked{% endif %}>
                        <label class="btn btn-outline-primary btn-sm" for="job_type_contract">Contract</label>
                    </div>
                    
                    <!-- Experience Level Filter -->
                    <div class="btn-group me-3 mb-2" role="group">
                        <input type="radio" class="btn-check" name="experience_level" id="exp_all" value="" 
                               {% if not request.args.get('experience_level') %}checked{% endif %}>
                        <label class="btn btn-outline-success btn-sm" for="exp_all">All Levels</label>
                        
                        <input type="radio" class="btn-check" name="experience_level" id="exp_entry" value="entry" 
                               {% if request.args.get('experience_level') == 'entry' %}checked{% endif %}>
                        <label class="btn btn-outline-success btn-sm" for="exp_entry">Entry</label>
                        
                        <input type="radio" class="btn-check" name="experience_level" id="exp_mid" value="mid" 
                               {% if request.args.get('experience_level') == 'mid' %}checked{% endif %}>
                        <label class="btn btn-outline-success btn-sm" for="exp_mid">Mid</label>
                        
                        <input type="radio" class="btn-check" name="experience_level" id="exp_senior" value="senior" 
                               {% if request.args.get('experience_level') == 'senior' %}checked{% endif %}>
                        <label class="btn btn-outline-success btn-sm" for="exp_senior">Senior</label>
                    </div>
                </div>
            </div>
            <div class="col-md-4 text-end">
                <div class="d-flex align-items-center justify-content-end">
                    <span class="me-2 text-muted">Sort by:</span>
                    <select name="sort" class="form-select form-select-sm w-auto">
                        <option value="created_at" {% if request.args.get('sort') == 'created_at' %}selected{% endif %}>Latest</option>
                        <option value="title" {% if request.args.get('sort') == 'title' %}selected{% endif %}>Title</option>
                        <option value="salary" {% if request.args.get('sort') == 'salary' %}selected{% endif %}>Salary</option>
                        <option value="location" {% if request.args.get('sort') == 'location' %}selected{% endif %}>Location</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Jobs Results -->
<section class="py-5">
    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <!-- Results Header -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h2>
                            {% if request.args.get('search') %}
                                Search Results for "{{ request.args.get('search') }}"
                            {% else %}
                                All Jobs
                            {% endif %}
                        </h2>
                        <p class="text-muted mb-0">{{ jobs.total }} jobs found</p>
                    </div>
                    <div class="view-toggles">
                        <div class="btn-group" role="group">
                            <input type="radio" class="btn-check" name="view" id="list-view" checked>
                            <label class="btn btn-outline-secondary btn-sm" for="list-view">
                                <i class="fas fa-list"></i>
                            </label>
                            <input type="radio" class="btn-check" name="view" id="grid-view">
                            <label class="btn btn-outline-secondary btn-sm" for="grid-view">
                                <i class="fas fa-th-large"></i>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Job Listings -->
                <div id="jobs-container">
                    {% if jobs.items %}
                        {% for job in jobs.items %}
                        <div class="job-card card border-0 shadow-sm mb-4">
                            <div class="card-body">
                                <div class="row align-items-start">
                                    <div class="col-md-8">
                                        <div class="d-flex justify-content-between align-items-start mb-2">
                                            <h4 class="job-title mb-0">
                                                <a href="{{ url_for('jobseeker.job_detail', job_id=job.id) }}" 
                                                   class="text-decoration-none">
                                                    {{ job.title }}
                                                </a>
                                            </h4>
                                            <div class="job-badges">
                                                {% if job.job_type %}
                                                    <span class="badge bg-primary me-1">{{ job.job_type.replace('_', ' ').title() }}</span>
                                                {% endif %}
                                                {% if job.experience_level %}
                                                    <span class="badge bg-success me-1">{{ job.experience_level.title() }}</span>
                                                {% endif %}
                                                <span class="badge bg-{{ 'success' if job.is_active else 'secondary' }}">
                                                    {{ 'Active' if job.is_active else 'Inactive' }}
                                                </span>
                                            </div>
                                        </div>
                                        
                                        <div class="company-info mb-2">
                                            <span class="text-primary fw-semibold">
                                                <i class="fas fa-building me-1"></i>
                                                {{ job.consultancy.company_name if job.consultancy else 'Anonymous Company' }}
                                            </span>
                                            {% if job.location %}
                                            <span class="text-muted ms-3">
                                                <i class="fas fa-map-marker-alt me-1"></i>
                                                {{ job.location }}
                                            </span>
                                            {% endif %}
                                        </div>
                                        
                                        {% if job.salary_min and job.salary_max %}
                                        <div class="salary-info mb-3">
                                            <span class="text-success fw-bold">
                                                <i class="fas fa-dollar-sign me-1"></i>
                                                ${{ "{:,.0f}".format(job.salary_min) }} - ${{ "{:,.0f}".format(job.salary_max) }}
                                                {% if job.salary_type %} / {{ job.salary_type }}{% endif %}
                                            </span>
                                        </div>
                                        {% endif %}
                                        
                                        <div class="job-description mb-3">
                                            <p class="text-muted mb-0">
                                                {{ job.description[:150] }}{% if job.description|length > 150 %}...{% endif %}
                                            </p>
                                        </div>
                                        
                                        {% if job.requirements %}
                                        <div class="job-skills mb-3">
                                            {% set skills = job.requirements.split(',')[:3] %}
                                            {% for skill in skills %}
                                                <span class="badge bg-light text-dark me-1">{{ skill.strip() }}</span>
                                            {% endfor %}
                                            {% if job.requirements.split(',')|length > 3 %}
                                                <span class="badge bg-light text-dark">+{{ job.requirements.split(',')|length - 3 }} more</span>
                                            {% endif %}
                                        </div>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="col-md-4 text-end">
                                        <div class="job-actions mb-3">
                                            <a href="{{ url_for('jobseeker.job_detail', job_id=job.id) }}" 
                                               class="btn btn-primary btn-sm me-2">
                                                <i class="fas fa-eye"></i> View Details
                                            </a>
                                            {% if current_user.is_authenticated and current_user.has_role('jobseeker') %}
                                            <button class="btn btn-outline-primary btn-sm apply-btn" 
                                                    data-job-id="{{ job.id }}">
                                                <i class="fas fa-paper-plane"></i> Apply
                                            </button>
                                            {% else %}
                                            <button class="btn btn-outline-primary btn-sm" onclick="alert('Please log in to apply for jobs')">
                                                <i class="fas fa-paper-plane"></i> Apply
                                            </button>
                                            {% endif %}
                                        </div>
                                        
                                        <div class="job-meta text-muted small">
                                            <div class="mb-1">
                                                <i class="fas fa-clock me-1"></i>
                                                Posted {{ job.created_at.strftime('%m/%d/%Y') }}
                                            </div>
                                            <div>
                                                <i class="fas fa-users me-1"></i>
                                                {{ job.applications|length }} applications
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                        
                        <!-- Pagination -->
                        {% if jobs.pages > 1 %}
                        <nav aria-label="Job search pagination" class="mt-4">
                            <ul class="pagination justify-content-center">
                                {% if jobs.has_prev %}
                                <li class="page-item">
                                    <a class="page-link" href="{{ url_for('jobseeker.jobs', page=jobs.prev_num, **request.args) }}">
                                        Previous
                                    </a>
                                </li>
                                {% endif %}
                                
                                {% for page_num in jobs.iter_pages() %}
                                    {% if page_num %}
                                        {% if page_num != jobs.page %}
                                        <li class="page-item">
                                            <a class="page-link" href="{{ url_for('jobseeker.jobs', page=page_num, **request.args) }}">
                                                {{ page_num }}
                                            </a>
                                        </li>
                                        {% else %}
                                        <li class="page-item active">
                                            <span class="page-link">{{ page_num }}</span>
                                        </li>
                                        {% endif %}
                                    {% else %}
                                    <li class="page-item disabled">
                                        <span class="page-link">...</span>
                                    </li>
                                    {% endif %}
                                {% endfor %}
                                
                                {% if jobs.has_next %}
                                <li class="page-item">
                                    <a class="page-link" href="{{ url_for('jobseeker.jobs', page=jobs.next_num, **request.args) }}">
                                        Next
                                    </a>
                                </li>
                                {% endif %}
                            </ul>
                        </nav>
                        {% endif %}
                        
                    {% else %}
                        <!-- No Jobs Found -->
                        <div class="text-center py-5">
                            <div class="empty-state">
                                <i class="fas fa-search fa-4x text-muted mb-3"></i>
                                <h3 class="text-muted">No Jobs Found</h3>
                                {% if request.args.get('search') %}
                                <p class="text-muted">
                                    We couldn't find any jobs matching "{{ request.args.get('search') }}".
                                    <br>Try adjusting your search criteria or browse all available jobs.
                                </p>
                                <a href="{{ url_for('jobseeker.jobs') }}" class="btn btn-primary">
                                    <i class="fas fa-list"></i> Browse All Jobs
                                </a>
                                {% else %}
                                <p class="text-muted">
                                    No jobs are currently available. Check back later for new opportunities!
                                </p>
                                <a href="{{ url_for('jobseeker.index') }}" class="btn btn-primary">
                                    <i class="fas fa-home"></i> Back to Home
                                </a>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Sidebar -->
            <div class="col-md-4">
                <div class="sidebar">
                    <!-- Quick Apply -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body">
                            <h5 class="card-title">
                                <i class="fas fa-rocket text-primary me-2"></i>
                                Quick Apply
                            </h5>
                            <p class="card-text text-muted">
                                Upload your resume once and apply to multiple jobs with just one click.
                            </p>
                            {% if current_user.is_authenticated %}
                            <a href="{{ url_for('jobseeker.profile') }}" class="btn btn-primary btn-sm">
                                Update Profile
                            </a>
                            {% else %}
                            <button class="btn btn-primary btn-sm" onclick="alert('Registration feature coming soon!')">
                                Create Account
                            </button>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Job Alerts -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body">
                            <h5 class="card-title">
                                <i class="fas fa-bell text-warning me-2"></i>
                                Job Alerts
                            </h5>
                            <p class="card-text text-muted">
                                Get notified when new jobs matching your criteria are posted.
                            </p>
                            <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#jobAlertModal">
                                <i class="fas fa-plus"></i> Set Alert
                            </button>
                        </div>
                    </div>
                    
                    <!-- Popular Categories -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body">
                            <h5 class="card-title">Popular Categories</h5>
                            <div class="category-list">
                                <a href="{{ url_for('jobseeker.jobs', category='technology') }}" 
                                   class="d-flex justify-content-between text-decoration-none mb-2">
                                    <span>Technology</span>
                                    <span class="badge bg-primary">{{ category_counts.get('technology', 0) }}</span>
                                </a>
                                <a href="{{ url_for('jobseeker.jobs', category='finance') }}" 
                                   class="d-flex justify-content-between text-decoration-none mb-2">
                                    <span>Finance</span>
                                    <span class="badge bg-primary">{{ category_counts.get('finance', 0) }}</span>
                                </a>
                                <a href="{{ url_for('jobseeker.jobs', category='healthcare') }}" 
                                   class="d-flex justify-content-between text-decoration-none mb-2">
                                    <span>Healthcare</span>
                                    <span class="badge bg-primary">{{ category_counts.get('healthcare', 0) }}</span>
                                </a>
                                <a href="{{ url_for('jobseeker.jobs', category='marketing') }}" 
                                   class="d-flex justify-content-between text-decoration-none mb-2">
                                    <span>Marketing</span>
                                    <span class="badge bg-primary">{{ category_counts.get('marketing', 0) }}</span>
                                </a>
                                <a href="{{ url_for('jobseeker.jobs', category='education') }}" 
                                   class="d-flex justify-content-between text-decoration-none mb-2">
                                    <span>Education</span>
                                    <span class="badge bg-primary">{{ category_counts.get('education', 0) }}</span>
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Career Tips -->
                    <div class="card border-0 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title">
                                <i class="fas fa-lightbulb text-success me-2"></i>
                                Career Tips
                            </h5>
                            <div class="tips-list">
                                <div class="tip-item mb-3">
                                    <h6 class="mb-1">Optimize Your Profile</h6>
                                    <p class="small text-muted mb-0">Complete your profile to get 5x more views from recruiters.</p>
                                </div>
                                <div class="tip-item mb-3">
                                    <h6 class="mb-1">Customize Applications</h6>
                                    <p class="small text-muted mb-0">Tailor your resume and cover letter for each application.</p>
                                </div>
                                <div class="tip-item">
                                    <h6 class="mb-1">Follow Up</h6>
                                    <p class="small text-muted mb-0">Send a polite follow-up email 1-2 weeks after applying.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Job Alert Modal -->
<div class="modal fade" id="jobAlertModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Create Job Alert</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="jobAlertForm">
                    <div class="mb-3">
                        <label for="alertKeywords" class="form-label">Keywords</label>
                        <input type="text" class="form-control" id="alertKeywords" 
                               placeholder="e.g. Python Developer, Marketing Manager">
                    </div>
                    <div class="mb-3">
                        <label for="alertLocation" class="form-label">Location</label>
                        <input type="text" class="form-control" id="alertLocation" 
                               placeholder="e.g. New York, Remote">
                    </div>
                    <div class="mb-3">
                        <label for="alertCategory" class="form-label">Category</label>
                        <select class="form-select" id="alertCategory">
                            <option value="">Any Category</option>
                            <option value="technology">Technology</option>
                            <option value="finance">Finance</option>
                            <option value="healthcare">Healthcare</option>
                            <option value="marketing">Marketing</option>
                            <option value="education">Education</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary">Create Alert</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.hero-section {
    min-height: 400px;
}

.job-search-form .form-control,
.job-search-form .form-select {
    border: 2px solid rgba(255, 255, 255, 0.2);
    background: rgba(255, 255, 255, 0.9);
}

.search-stats {
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.job-card {
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
}

.job-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1) !important;
}

.job-title a {
    color: #333;
    transition: color 0.2s ease-in-out;
}

.job-title a:hover {
    color: #0d6efd;
}

.sidebar .card {
    transition: transform 0.2s ease-in-out;
}

.sidebar .card:hover {
    transform: translateY(-1px);
}

.category-list a {
    color: #333;
    padding: 0.25rem 0;
    border-radius: 4px;
    transition: background-color 0.2s ease-in-out;
}

.category-list a:hover {
    background-color: rgba(13, 110, 253, 0.1);
    color: #0d6efd;
}

.btn-check:checked + .btn {
    background-color: #0d6efd;
    border-color: #0d6efd;
    color: white;
}

.empty-state {
    padding: 2rem;
}

@media (max-width: 768px) {
    .hero-section .row {
        text-align: center;
    }
    
    .job-card .row {
        text-align: left;
    }
    
    .job-actions {
        margin-top: 1rem;
        text-align: left;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Apply button functionality
    document.querySelectorAll('.apply-btn').forEach(button => {
        button.addEventListener('click', function() {
            const jobId = this.getAttribute('data-job-id');
            // Handle job application logic here
            console.log('Applying for job:', jobId);
            
            // Show success message (you can implement actual application logic)
            this.innerHTML = '<i class="fas fa-check"></i> Applied';
            this.classList.remove('btn-outline-primary');
            this.classList.add('btn-success');
            this.disabled = true;
        });
    });
    
    // Filter change handlers
    document.querySelectorAll('input[name="job_type"], input[name="experience_level"]').forEach(input => {
        input.addEventListener('change', function() {
            // Auto-submit form when filters change
            const form = document.querySelector('.job-search-form');
            const formData = new FormData(form);
            
            // Add filter values to form data
            formData.set(this.name, this.value);
            
            // Submit form
            const params = new URLSearchParams();
            for (const [key, value] of formData.entries()) {
                if (value) params.append(key, value);
            }
            
            window.location.search = params.toString();
        });
    });
    
    // Sort change handler
    document.querySelector('select[name="sort"]').addEventListener('change', function() {
        const params = new URLSearchParams(window.location.search);
        params.set('sort', this.value);
        window.location.search = params.toString();
    });
    
    // View toggle handlers
    document.querySelectorAll('input[name="view"]').forEach(input => {
        input.addEventListener('change', function() {
            const container = document.getElementById('jobs-container');
            if (this.id === 'grid-view') {
                container.classList.add('grid-view');
            } else {
                container.classList.remove('grid-view');
            }
        });
    });
});
</script>
{% endblock %}